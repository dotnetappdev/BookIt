@page "/{tenantSlug}/admin/settings"
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@layout BookIt.UI.Shared.Components.Admin.AdminLayout
@inject BookItAuthState Auth
@inject NavigationManager Nav

<PageTitle>Settings — BookIt Admin</PageTitle>

@if (!Auth.IsAuthenticated)
{
    <MudText>Redirecting…</MudText>
}
else
{
    <BookIt.UI.Shared.Components.Admin.SettingsView TenantSlug="@TenantSlug" HostUrl="@_host" />
}

@code {
    [Parameter] public string TenantSlug { get; set; } = "";
    private string _host = "";

    protected override void OnInitialized()
    {
        if (!Auth.IsAuthenticated)
            Nav.NavigateTo($"/login?returnUrl=/{TenantSlug}/admin/settings");
        var uri = new Uri(Nav.BaseUri);
        _host = $"{uri.Scheme}://{uri.Authority}";
    }
}
