@using BookIt.Core.DTOs
@{
    var tenant = ViewBag.Tenant as TenantResponse;
    var service = ViewBag.Service as ServiceResponse;
    var tenantSlug = ViewBag.TenantSlug as string ?? "";
    var serviceSlug = ViewBag.ServiceSlug as string ?? "";
    var canonicalUrl = ViewBag.CanonicalUrl as string ?? $"/{tenantSlug}/book/{serviceSlug}";

    var pageTitle = $"{service?.Name} — Book at {tenant?.Name}";
    var pageDescription = !string.IsNullOrEmpty(service?.Description)
        ? $"{service.Description}. Book online at {tenant?.Name} — choose your time and confirm instantly."
        : $"Book {service?.Name} at {tenant?.Name}. Online booking, instant confirmation.";

    ViewData["Title"] = pageTitle;
}

@section MetaTags {
    <title>@pageTitle</title>
    <meta name="description" content="@pageDescription" />
    <link rel="canonical" href="@canonicalUrl" />
    <meta property="og:title" content="@pageTitle" />
    <meta property="og:description" content="@pageDescription" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="@canonicalUrl" />
    @if (!string.IsNullOrEmpty(service?.ImageUrl))
    {
        <meta property="og:image" content="@service.ImageUrl" />
    }
    else if (!string.IsNullOrEmpty(tenant?.LogoUrl))
    {
        <meta property="og:image" content="@tenant.LogoUrl" />
    }
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="@pageTitle" />
    <meta name="twitter:description" content="@pageDescription" />
}

@if (tenant != null && service != null)
{
    <style>
        :root { --primary: @(tenant.PrimaryColor ?? "#6c5ce7"); }
        .btn-brand { background-color: var(--primary); color: #fff; border: none; }
        .btn-brand:hover { opacity: 0.9; color: #fff; }
    </style>

    <!-- Business / Service Header -->
    <div style="background:linear-gradient(135deg,var(--primary) 0%,color-mix(in srgb,var(--primary) 70%,#000) 100%);position:relative;overflow:hidden;">
        <div style="position:absolute;inset:0;background-image:linear-gradient(rgba(255,255,255,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.04) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;"></div>
        <div class="container py-4" style="position:relative;z-index:1;">
            <div class="d-flex align-items-center gap-3">
                @if (!string.IsNullOrEmpty(tenant.LogoUrl))
                {
                    <img src="@tenant.LogoUrl" alt="@tenant.Name logo" class="rounded-3" style="width:52px;height:52px;object-fit:cover;box-shadow:0 2px 12px rgba(0,0,0,.25);" />
                }
                else
                {
                    <div style="width:52px;height:52px;border-radius:13px;background:rgba(255,255,255,.15);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.2);">
                        <i class="bi bi-building text-white" style="font-size:1.4rem;"></i>
                    </div>
                }
                <div>
                    <h1 class="h4 mb-0 fw-800 text-white" style="font-weight:800;letter-spacing:-.02em;">@tenant.Name</h1>
                    @if (!string.IsNullOrEmpty(tenant.Address))
                    {
                        <p class="mb-0 small" style="color:rgba(255,255,255,.65);margin-top:.15rem;"><i class="bi bi-geo-alt me-1"></i>@tenant.Address</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-7">
                <!-- Breadcrumb for SEO -->
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb" style="font-size:.875rem;">
                        <li class="breadcrumb-item"><a href="/@tenantSlug/book">All Services</a></li>
                        <li class="breadcrumb-item active" aria-current="page">@service.Name</li>
                    </ol>
                </nav>

                @if (!string.IsNullOrEmpty(service.ImageUrl))
                {
                    <img src="@service.ImageUrl" alt="@service.Name at @tenant.Name" class="rounded-4 img-fluid mb-4 w-100" style="max-height:280px;object-fit:cover;" />
                }

                <h2 class="fw-bold mb-2" style="letter-spacing:-.02em;">@service.Name</h2>

                @if (!string.IsNullOrEmpty(service.CategoryName))
                {
                    <span class="badge bg-light text-dark border mb-3">@service.CategoryName</span>
                }

                <div class="d-flex flex-wrap gap-3 mb-4">
                    <div class="d-flex align-items-center gap-2 px-3 py-2 rounded-3 border bg-white">
                        <i class="bi bi-clock text-brand"></i>
                        <span class="fw-semibold">@service.DurationMinutes min</span>
                    </div>
                    <div class="d-flex align-items-center gap-2 px-3 py-2 rounded-3 border bg-white">
                        <i class="bi bi-currency-pound text-brand"></i>
                        <span class="fw-semibold">@service.Price.ToString("0.00")</span>
                    </div>
                    <div class="d-flex align-items-center gap-2 px-3 py-2 rounded-3 border bg-white">
                        <i class="bi bi-@(service.DefaultMeetingType == BookIt.Core.Enums.MeetingType.InPerson ? "geo-alt" : "camera-video") text-brand"></i>
                        <span class="fw-semibold">@(service.DefaultMeetingType == BookIt.Core.Enums.MeetingType.InPerson ? "In Person" : service.DefaultMeetingType.ToString())</span>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(service.Description))
                {
                    <p class="text-muted mb-4" style="font-size:1rem;line-height:1.7;">@service.Description</p>
                }

                <a href="/@tenantSlug/booking/formstep?serviceId=@service.Id"
                   class="btn btn-brand btn-lg w-100 py-3 mb-3"
                   style="border-radius:12px;font-size:1rem;font-weight:600;">
                    <i class="bi bi-calendar-check me-2"></i>Book @service.Name Now
                </a>
                <a href="/@tenantSlug/book" class="btn btn-outline-secondary w-100 py-2" style="border-radius:12px;">
                    <i class="bi bi-arrow-left me-2"></i>View All Services
                </a>
            </div>
        </div>
    </div>
}
