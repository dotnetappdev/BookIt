name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    name: Build & Test (.NET)
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '10.0.x'

      - name: Install MAUI Android workload
        run: dotnet workload install android maui-android

      - name: Restore solution
        run: dotnet restore BookIt.slnx

      - name: Build API
        run: dotnet build src/BookIt.API/BookIt.API.csproj --no-restore -c Release

      - name: Build Blazor
        run: dotnet build src/BookIt.Blazor/BookIt.Blazor.csproj --no-restore -c Release

      - name: Build Web
        run: dotnet build src/BookIt.Web/BookIt.Web.csproj --no-restore -c Release

      - name: Build MAUI (Android)
        # MAUI Android Release requires the AOT toolchain; use Debug for CI validation
        run: dotnet build src/BookIt.Maui/BookIt.Maui.csproj --no-restore

      - name: Run tests
        run: dotnet test tests/BookIt.Tests/BookIt.Tests.csproj --no-restore -c Release --logger "console;verbosity=normal"
